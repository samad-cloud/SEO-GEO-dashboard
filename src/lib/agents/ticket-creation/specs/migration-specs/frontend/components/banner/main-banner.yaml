name: MainBanner
source: src/components/banner/dynamic-promo-banner-v2.tsx
description: |
  Named sub-component exported from dynamic-promo-banner-v2.tsx. Renders the
  primary horizontal promotional banner strip at the top of home, category, and
  product pages. Supports up to three text/CTA section slots and an optional
  countdown clock. Desktop and mobile layouts differ significantly: product pages
  suppress the CTA on desktop when a countdown is present; the home page positions
  the countdown on the left side of the desktop layout; non-home/non-product pages
  place the countdown on the right. CTA sections are injected into section slots by
  overwriting based on position config. Integrates Matomo analytics for CTA clicks.

exports:
  - name: MainBanner
    type: component$ (named export from dynamic-promo-banner-v2.tsx)
    description: Renders the main promotional banner strip with responsive layouts

props:
  - name: data
    type: MainBannerSection
    required: true
    description: Full main banner configuration including desktop and mobile sub-objects.
  - name: type
    type: "'product' | 'category' | 'home'"
    required: false
    description: Page context; controls countdown placement and CTA visibility rules.

component_structure:
  mobile_product_with_countdown:
    wrapper: "flex lg:hidden px-2 py-2 (minHeight: 64px)"
    layout: "justify-between items-center"
    children:
      - left: filtered text sections (sections without type=CTA), flex-1
      - right: CountdownSectionComponent (45% width, max 200px)

  mobile_product_cta_no_countdown:
    wrapper: "flex lg:hidden px-2 py-2 (minHeight: 64px)"
    layout: "justify-between items-center"
    children:
      - left: filtered text sections (sections without type=CTA), flex-1
      - right: CTA button (45% width, max 200px)

  mobile_product_neither:
    wrapper: "flex lg:hidden px-2 py-2 (minHeight: 64px)"
    layout: "justify-center items-center"
    children:
      - centered: all text sections

  mobile_non_product_with_countdown:
    wrapper: "flex lg:hidden px-2 py-2 (minHeight: 64px)"
    layout: "items-center"
    children:
      - left: section1, section2, section3 (flex-1)
      - right: CountdownSectionComponent (45% width, max 200px)

  mobile_non_product_no_countdown:
    wrapper: "flex lg:hidden px-2 py-2 (minHeight: 64px)"
    layout: "justify-center items-center"
    children:
      - centered: section1, section2, section3

  desktop_product_with_countdown:
    wrapper: "hidden lg:block py-2 px-4 (minHeight: 56px)"
    layout: "flex justify-between items-center lg:px-[10px] mx-auto"
    children:
      - section1 (left)
      - section2 (center)
      - CountdownSectionComponent (right, 250px)
      - NO CTA shown

  desktop_home_with_countdown:
    wrapper: "hidden lg:block p-4 (minHeight: 88px)"
    layout: "flex justify-between items-center lg:px-[10px] mx-auto"
    children:
      - CountdownSectionComponent (left, overflow-hidden)
      - section1
      - section2
      - section3

  desktop_non_home_non_product_with_countdown:
    wrapper: "hidden lg:block p-4 (minHeight: 88px)"
    layout: "flex justify-between items-center lg:px-[10px] mx-auto"
    children:
      - section1
      - section2
      - CountdownSectionComponent (right, 250px)
      - section3

  desktop_no_countdown:
    wrapper: "hidden lg:block p-4 (minHeight: 56px for product, 88px otherwise)"
    layout: "flex justify-between items-center lg:px-[10px] mx-auto"
    children:
      - section1, section2, section3

child_components:
  - name: BannerFlipClock
    source: "~/components/product-page/banner-flip-clock/banner-flip-clock"
    props:
      - deliveryDeadline: countdown.expiryDateTime
      - clockColor: countdown.clockBgColor
      - textColor: countdown.clockTextColor
      - bannerType: type
  - name: BannerSection (internal, not separately exported)
    purpose: Renders a filtered array of PromoBannerSection items; TEXT via dangerouslySetInnerHTML, CTA via <a> with Matomo tracking.
  - name: CountdownSectionComponent (internal, not separately exported)
    purpose: Wraps optional title paragraph + BannerFlipClock.

state_management:
  signals:
    - name: displayData
      type: MainBannerSection
      description: |
        Derived from data prop via useTask$ on data change. CTA injection applied:
        desktop ctaDisplayDesktop/ctaPosition → replaces section slot;
        mobile ctaDisplayMobile/ctaPosition → replaces section slot.
        Font properties copied from replaced section when injecting CTA.

data_structure:
  MainBannerSection:
    description: Root prop type containing desktop and mobile banner configs
    fields:
      - desktop:
          backgroundColor: string
          section1: PromoBannerSection[]
          section2: PromoBannerSection[]
          section3: PromoBannerSection[]
          countdown: CountdownSection | null
          ctaDisplayDesktop: boolean
          ctaPosition: number (1-3)
          ctaText: string
          ctaColor: string
          ctaBgColor: string
          ctaUrl: string
      - mobile:
          backgroundColor: string
          section1: PromoBannerSection[]
          section2: PromoBannerSection[]
          section3: PromoBannerSection[]
          countdown: CountdownSection | null
          ctaDisplayMobile: boolean
          ctaPosition: number (1-3)
          ctaText: string
          ctaColor: string
          ctaBgColor: string
          ctaUrl: string

  PromoBannerSection:
    fields:
      - display: boolean
      - text: string
      - fontSize: string
      - isBold: boolean
      - isItalic: boolean
      - isUnderline: boolean
      - color: string
      - backgroundColor: string
      - type: "'TEXT' | 'CTA'"
      - href: string

  CountdownSection:
    fields:
      - display: boolean
      - title: string (optional)
      - expiryDateTime: string
      - clockBgColor: string
      - clockTextColor: string
      - textColor: string

behavior:
  - step: 1
    action: "On data change (useTask$), CTA injection runs for desktop config: if ctaDisplayDesktop is true and ctaPosition is 1, 2, or 3, the corresponding section slot is replaced with a single CTA object inheriting font properties (fontSize, isBold, isItalic, isUnderline) from the original section[0]."
  - step: 2
    action: "Same injection runs for mobile config if ctaDisplayMobile is true and ctaPosition is 1-3."
  - step: 3
    action: "Mobile render: determines page type and countdown presence to select layout variant."
  - step: 4
    action: "Mobile + type='product' + countdown present: renders left column (sections without CTA, flex-1) and right column (CountdownSectionComponent, 45% width, max 200px)."
  - step: 5
    action: "Mobile + type='product' + no countdown + CTA present: renders left column (sections without CTA) and right column (CTA <a> button, 45% width, max 200px)."
  - step: 6
    action: "Mobile + type='product' + neither countdown nor CTA: centers all text sections."
  - step: 7
    action: "Mobile + type not 'product' + countdown: renders section stack on left (flex-1) and countdown on right (45% width, max 200px)."
  - step: 8
    action: "Mobile + type not 'product' + no countdown: centers all sections."
  - step: 9
    action: "Desktop + type='product' + countdown: section1 left, section2 center, countdown right (250px). No CTA rendered."
  - step: 10
    action: "Desktop + type='home' + countdown: countdown left (overflow-hidden), section1, section2, section3."
  - step: 11
    action: "Desktop + type not 'home' nor 'product' + countdown: section1, section2, countdown right (250px), section3."
  - step: 12
    action: "Desktop + no countdown: section1, section2, section3 with justify-between."
  - step: 13
    action: "BannerSection renders items filtered by item.display===true. TEXT type uses dangerouslySetInnerHTML and getStylesFromProperties() inline styles. CTA type renders <a> with pushMatomoEvent(CLICK_PROMO_BANNER_CTA, href) on click."
  - step: 14
    action: "CountdownSectionComponent renders optional countdown.title paragraph then BannerFlipClock with expiryDateTime, clockBgColor, clockTextColor, and bannerType."
  - step: 15
    action: "The desktop banner wrapper is styled with inline backgroundColor from displayData.desktop.backgroundColor. The mobile wrapper uses displayData.mobile.backgroundColor."

styling:
  mobile_wrapper: "flex lg:hidden px-2 py-2 (minHeight: 64px, inline backgroundColor)"
  desktop_wrapper_product: "hidden lg:block py-2 px-4 (minHeight: 56px, inline backgroundColor)"
  desktop_wrapper_other: "hidden lg:block p-4 (minHeight: 88px, inline backgroundColor)"
  inner_container: "flex justify-between items-center lg:px-[10px] mx-auto max-w-[600px] (mobile) | mx-auto (desktop)"
  clock_mobile: "45% width, max-width: 200px"
  clock_desktop: "250px width"
  cta_mobile: "45% width, max-width: 200px"
  cta_promo_banner: "py-2 px-4 rounded block text-center (+ inline styles from section)"
  main_promo_banner_clock: "main-promo-banner-clock (wrapper class around countdown)"
  getStylesFromProperties:
    - color: section.color
    - fontWeight: "section.isBold ? 'bold' : 'normal'"
    - fontSize: section.fontSize
    - fontStyle: "section.isItalic ? 'italic' : 'normal'"
    - textDecoration: "section.isUnderline ? 'underline' : 'none'"
    - backgroundColor: section.backgroundColor

analytics:
  matomo:
    event: CLICK_PROMO_BANNER_CTA
    category: MatomoCategory.COMMON
    label: section.href

dependencies:
  qwik:
    - component$, useSignal, useTask$ from @builder.io/qwik
  types:
    - MainBannerSection, PromoBannerSection, CountdownSection from ~/services/json-service
  utilities:
    - MatomoCategory, MatomoEvent, pushMatomoEvent from ~/utility/matomo
  components:
    - BannerFlipClock from ~/components/product-page/banner-flip-clock/banner-flip-clock

used_by:
  - DynamicPromoBannerV2
  - CategoryPageTopBannerV2
  - ProductPageTopBannerV2
  - CollectionContainer
  - ShopPageContainer
  - HomeLayout
  - LayoutShop
  - Layout

security:
  - CTA hrefs and text content are rendered from CMS data without sanitization.
  - No authentication required; public-facing component.

edge_cases:
  - Desktop product page with countdown: CTA is explicitly suppressed — no CTA anchor rendered.
  - Mobile product page: CTA shown on right only when countdown is absent.
  - CTA injection position out of range (not 1-3): no replacement; original section unchanged.
  - Empty section arrays: BannerSection renders nothing.
  - Countdown with display: false: CountdownSectionComponent not rendered.
  - Missing countdown section entirely: layout variant without clock is used.
  - Home page countdown placement (desktop): differs from all other page types — left side.

notes:
  - MainBanner is a named export from the same file as FloatingBanner and DynamicPromoBannerV2.
  - There is no separate main-banner.tsx file; this component lives in dynamic-promo-banner-v2.tsx.
  - On the home page route, MainBanner is rendered twice with different CSS visibility classes to handle desktop/mobile ordering (desktop above carousel, mobile below it).
  - The class "main-promo-banner-clock" wraps the countdown on main banners; differs from floating banners.

types:
  MainBannerProps:
    description: Props interface for MainBanner
    fields:
      - name: data
        type: MainBannerSection
      - name: type
        type: "'product' | 'category' | 'home'"
        optional: true

  MainBannerSection:
    description: Root configuration for the main banner; contains desktop and mobile sub-objects
    fields:
      - name: desktop
        type: MainBannerConfig
      - name: mobile
        type: MainBannerConfig

  MainBannerConfig:
    description: Desktop or mobile specific main banner configuration
    fields:
      - name: backgroundColor
        type: string
      - name: section1
        type: PromoBannerSection[]
      - name: section2
        type: PromoBannerSection[]
      - name: section3
        type: PromoBannerSection[]
      - name: countdown
        type: "CountdownSection | null"
      - name: ctaDisplayDesktop
        type: boolean
        note: For desktop; equivalent is ctaDisplayMobile for mobile
      - name: ctaPosition
        type: number
        note: 1-3
      - name: ctaText
        type: string
      - name: ctaColor
        type: string
      - name: ctaBgColor
        type: string
      - name: ctaUrl
        type: string

  PromoBannerSection:
    description: Individual text or CTA item within a section slot
    fields:
      - name: display
        type: boolean
      - name: text
        type: string
      - name: fontSize
        type: string
      - name: isBold
        type: boolean
      - name: isItalic
        type: boolean
      - name: isUnderline
        type: boolean
      - name: color
        type: string
      - name: backgroundColor
        type: string
      - name: type
        type: "'TEXT' | 'CTA'"
      - name: href
        type: string

  CountdownSection:
    description: Countdown clock configuration within a banner
    fields:
      - name: display
        type: boolean
      - name: title
        type: string
        optional: true
      - name: expiryDateTime
        type: string
      - name: clockBgColor
        type: string
      - name: clockTextColor
        type: string
      - name: textColor
        type: string

field_consumption:
  MainBannerSection:
    consumed:
      - desktop.backgroundColor: Applied as inline style to desktop wrapper div
      - desktop.section1 / section2 / section3: Passed to BannerSection; may be replaced by CTA injection
      - desktop.countdown: Passed to CountdownSectionComponent if present
      - desktop.ctaDisplayDesktop: Gates CTA injection for desktop sections
      - desktop.ctaPosition / ctaText / ctaColor / ctaBgColor / ctaUrl: CTA injection content
      - mobile.backgroundColor: Applied as inline style to mobile wrapper div
      - mobile.section1 / section2 / section3: Passed to mobile BannerSection instances
      - mobile.countdown: Passed to mobile CountdownSectionComponent
      - mobile.ctaDisplayMobile / ctaPosition / ctaText / ctaColor / ctaBgColor / ctaUrl: Mobile CTA injection
    ignored: []

  PromoBannerSection:
    consumed:
      - display: Filters items (only display===true rendered)
      - text: Content for TEXT/CTA rendering
      - fontSize / isBold / isItalic / isUnderline / color / backgroundColor: Inline styles
      - type: Determines TEXT vs CTA render path
      - href: CTA anchor href and Matomo event label
    ignored: []

implementation_logic:
  cta_injection:
    rule: |
      Before rendering, useTask$ inspects desktop and mobile config.
      If ctaDisplayDesktop is true and ctaPosition is 1, 2, or 3, the section at that
      position in displayData is replaced with a single-item array:
        { type: 'CTA', text: ctaText, color: ctaColor, backgroundColor: ctaBgColor,
          href: ctaUrl, fontSize: <from original section[0]>, isBold: <from original>,
          isItalic: <from original>, isUnderline: <from original> }
      Mobile CTA injection is independent and uses ctaDisplayMobile + mobile ctaPosition/text/colors.
    critical: true

  desktop_product_countdown_suppresses_cta:
    rule: |
      On desktop when type === 'product' AND a countdown is present, CTA sections
      are not rendered even if ctaDisplayDesktop is true. The layout shows only
      section1, section2, and the countdown clock (no section3/CTA).
    critical: true

  mobile_product_clock_vs_cta_priority:
    rule: |
      On mobile when type === 'product': if countdown is present it takes the right
      slot. If countdown is absent but a CTA section exists, the CTA takes the right
      slot. If neither is present, sections are centered. Clock takes priority over CTA.
    critical: true

  home_countdown_left_placement:
    rule: |
      On desktop when type === 'home' and a countdown exists, the CountdownSectionComponent
      is placed on the LEFT side of the banner (before section1/section2/section3),
      wrapped in overflow-hidden. All other non-product page types place the countdown
      on the RIGHT side (after section2, before section3).
    critical: true

visibility_map:
  mobile_wrapper:
    condition: viewport < 1024px (Tailwind flex lg:hidden)
    default: hidden on desktop

  desktop_wrapper:
    condition: viewport >= 1024px (Tailwind hidden lg:block)
    default: hidden on mobile

  countdown_section:
    condition: "countdown exists AND countdown.display is true"
    default: hidden

  desktop_cta_product_with_countdown:
    condition: "type !== 'product' OR countdown not present"
    default: hidden on desktop product pages when countdown present

  mobile_right_slot_countdown:
    condition: "type === 'product' AND countdown present"
    default: shows CTA button if countdown absent but CTA present

  mobile_right_slot_cta:
    condition: "type === 'product' AND no countdown AND CTA section present"
    default: hidden when countdown present

  section_items:
    condition: "item.display === true"
    default: hidden (items with display===false filtered out)

  cta_anchor:
    condition: "section.type === 'CTA'"
    default: renders as <p> for TEXT type

  countdown_desktop_left:
    condition: "type === 'home' AND countdown present"
    default: placed on right for non-home pages
